!function(a,b){"use strict";function c(a,c){var e=b("#gaddon-setting-tab-field-"+c+"_notification_type");if(e.toggle(a),a){d(e.find("input[type=radio]:checked").val(),c),b("#gaddon-setting-tab-tab_"+c+"_notification i.gravityflow-tab-checked").show(),b("#gaddon-setting-tab-tab_"+c+"_notification i.gravityflow-tab-unchecked").hide()}else d("off",c),b("#gaddon-setting-tab-tab_"+c+"_notification i.gravityflow-tab-checked").hide(),b("#gaddon-setting-tab-tab_"+c+"_notification i.gravityflow-tab-unchecked").show()}function d(a,c){var d=["users","routing","from_name","from_email","reply_to","bcc","subject","message","autoformat","resend","gpdf"],e="#gaddon-setting-tab-field-"+c+"_notification_";b.each(d,function(a,c){b(e+c).hide()}),"off"!=a&&b.each(d,function(c,d){if("users"==d&&"routing"==a||"routing"==d&&"select"==a)return!0;b(e+d).fadeToggle("normal")})}function e(a){g({select:["workflow_notification_users\\[\\]","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat"],routing:["workflow_notification_routing","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat"]},a,!1)}function f(a){g({select:["assignees\\[\\]","editable_fields\\[\\]","conditional_logic_editable_fields_enabled"],routing:["routing","conditional_logic_editable_fields_enabled"]},a)}function g(a,c,d){var e=d?"#gaddon-setting-tab-field-":"#gaddon-setting-row-";b.each(a,function(a,c){b.each(c,function(a,c){b(e+c).hide()})}),b.each(a,function(a,d){c==a&&b.each(d,function(a,c){b(e+c).fadeToggle("normal")})})}function h(a){var c=b("#gaddon-setting-row-workflow_notification_type");if(c.toggle(a),a){e(c.find("input[type=radio]:checked").val())}else e("off")}function i(){for(var a=["routing","assignees\\[\\]","assignee_notification_from_name","assignee_notification_from_email","assignee_notification_reply_to","assignee_notification_bcc","assignee_notification_subject","assignee_notification_message","assignee_notification_autoformat","resend_assignee_email","assignee_notification_gpdf","rejection_notification_type","rejection_notification_users\\[\\]","rejection_notification_user_field","rejection_notification_routing","rejection_notification_message","rejection_notification_autoformat","approval_notification_type","approval_notification_users\\[\\]","approval_notification_user_field","approval_notification_routing","approval_notification_message","approval_notification_autoformat","workflow_notification_type","workflow_notification_users\\[\\]","workflow_notification_user_field","workflow_notification_routing","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","assignees\\[\\]","editable_fields\\[\\]","routing","assignee_notification_message"],c=0;c<a.length;c++)b("#gaddon-setting-row-"+a[c]).addClass("gravityflow_sub_setting")}function j(a,b,c,d,e,f){if(["_gaddon_setting_workflow_notification_message","_gaddon_setting_assignee_notification_message","_gaddon_setting_approval_notification_message","_gaddon_setting_rejection_notification_message"].indexOf(b)<0)return a;var g=gravityflow_form_settings_js_strings.mergeTagLabels,h=[];return h.push({tag:"{workflow_entry_link}",label:g.workflow_entry_link}),h.push({tag:"{workflow_entry_url}",label:g.workflow_entry_url}),h.push({tag:"{workflow_inbox_link}",label:g.workflow_inbox_link}),h.push({tag:"{workflow_inbox_url}",label:g.workflow_inbox_url}),h.push({tag:"{workflow_cancel_link}",label:g.workflow_cancel_link}),h.push({tag:"{workflow_cancel_url}",label:g.workflow_cancel_url}),h.push({tag:"{workflow_note}",label:g.workflow_note}),h.push({tag:"{workflow_timeline}",label:g.workflow_timeline}),h.push({tag:"{assignees}",label:g.assignees}),a.gravityflow={label:g.group,tags:h},a}function k(a,c,d,e,f,g){if(["_gaddon_setting_assignee_notification_message"].indexOf(c)<0)return a;var h=gravityflow_form_settings_js_strings.mergeTagLabels,i=[];return i.push({tag:"{workflow_approve_link}",label:h.workflow_approve_link}),i.push({tag:"{workflow_approve_url}",label:h.workflow_approve_url}),i.push({tag:"{workflow_approve_token}",label:h.workflow_approve_token}),i.push({tag:"{workflow_reject_link}",label:h.workflow_reject_link}),i.push({tag:"{workflow_reject_url}",label:h.workflow_reject_url}),i.push({tag:"{workflow_reject_token}",label:h.workflow_reject_token}),void 0!==a.gravityflow?a.gravityflow.tags=b.merge(a.gravityflow.tags,i):a.gravityflow={label:h.group,tags:i},a}function l(){var a=gravityflow_form_settings_js_strings.feedId;if(a>0){var c=ajaxurl+"?action=gravityflow_feed_message&fid="+a+"&id="+gravityflow_form_settings_js_strings.formId;b.get(c,function(a){b("#save_button").before(a)})}}b(document).ready(function(){b("#assignees, #editable_fields, #workflow_notification_users, .gravityflow-multiselect-ui").multiSelect();var d=!1,g=!1;b("form#gform-settings").submit(function(){g=!0,b("form#gform-settings").find(":input").removeAttr("disabled")}),b(":input").change(function(){d=!0}),window.onbeforeunload=function(){if(d&&!g)return"You have unsaved changes."};var j=b("input[name=_gaddon_setting_step_type]:checked"),k=(j.val(),b("#status_expiration")),m="expired"==k.val();b("#expiration_sub_setting_destination_expired").toggle(m),k.change(function(){var a="expired"==b(this).val();b("#expiration_sub_setting_destination_expired").fadeToggle(a)}),i(),f(b("input[name=_gaddon_setting_type]:checked").val()),b("#gaddon-setting-row-type input[type=radio]").change(function(){f(this.value)}),a.getUsersMarkup=function(a){var b,c,d,e=gf_routing_setting_strings.accounts,f='<select class="gform-routing-users '+a+'_{i}">';for(b=0;b<e.length;b++)if(d=e[b],void 0!==d.choices){var g,h="";for(c=0;c<d.choices.length;c++)g=d.choices[c],h+='<option value="{0}">{1}</option>'.format(g.value,g.label);f+='<optgroup label="{0}">{1}</option>'.format(d.label,h)}else f+='<option value="{0}">{1}</option>'.format(d.value,d.label);return f+="</select>"};var n,o=b("#gform_routing_setting"),p=b("#routing").val(),q=p?b.parseJSON(p):null;b("#editable_fields").length>0?(q||(q=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,editable_fields:[gf_routing_setting_strings.input_fields[0].key],fieldId:"0",operator:"is",value:"",type:""}],b("#user_input_routing").val(b.toJSON(q))),n={fieldName:o.data("field_name"),fieldId:o.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:q,callbacks:{addNewTarget:function(c,d){var e=a.getUsersMarkup("assignee"),f=b("#editable_fields").clone();f.attr("name","editable_fields");b("#gform-routings tbody tr").length;return f.attr("id","editable_fields_routing_{i}"),f.attr("style",""),f.addClass("gform-routing-input-field editable_fields_{i}"),e+="</td><td>"+f[0].outerHTML},header:function(a,b){return'<thead><tr><th>Assign To</th><th>Editable Fields</th><th colspan="3">Condition</th></tr></thead>'}}}):(q||(q=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],b("#routing").val(b.toJSON(q))),n={fieldName:o.data("field_name"),fieldId:o.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:q,callbacks:{addNewTarget:function(b,c){return a.getUsersMarkup("assignee")}}}),o.gfRoutingSetting(n),b("#gaddon-setting-row-workflow_notification_type input[type=radio]").click(function(){e(this.value)}),h(b("#workflow_notification_enabled").prop("checked")),b("#workflow_notification_enabled").click(function(){h(this.checked)});var r=b("#gform_user_routing_setting_workflow_notification_routing"),s=b("#workflow_notification_routing").val(),t=s?b.parseJSON(s):null;t||(t=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],b("#workflow_notification_routing").val(b.toJSON(t)));var u={fieldName:r.data("field_name"),fieldId:r.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:t,callbacks:{addNewTarget:function(b,c){return a.getUsersMarkup("assignee")}}};r.gfRoutingSetting(u),a.initNotificationTab=function(d){b("#"+d+"_notification_users").multiSelect();var e=b("#"+d+"_notification_enabled");c(e.prop("checked"),d),e.click(function(){c(this.checked,d)}),b("#gaddon-setting-tab-field-"+d+"_notification_type input[type=radio]").click(function(){c(!0,d)});var f=b("#gform_user_routing_setting_"+d+"_notification_routing");if(f.length){var g=b("#"+d+"_notification_routing"),h=g.val(),i=h?b.parseJSON(h):null;i||(i=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],g.val(b.toJSON(i)));var j={fieldName:f.data("field_name"),fieldId:f.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:i,callbacks:{addNewTarget:function(b,c){return a.getUsersMarkup("assignee")}}};f.gfRoutingSetting(j)}};for(var v=["assignee","rejection","approval","in_progress","complete"],w=0;w<v.length;w++)a.initNotificationTab(v[w]);var x=b("#default_status");"hidden"===x.val()&&b("#tabs-notification_tabs").tabs("disable",1),x.change(function(){var a="hidden"===b(this).val(),c=b("#tabs-notification_tabs");if(a){var d=b("#in_progress_notification_enabled");d.prop("checked")&&d.click(),1===c.tabs("option","active")&&c.tabs("option","active",0),c.tabs("disable",1)}else c.tabs("enable",1)}),window.gform&&gform.addFilter("gform_merge_tags",a.gravityflow_add_merge_tags),window.gformInitDatepicker&&gformInitDatepicker(),l()}),a.gravityflow_add_merge_tags=function(a,b,c,d,e,f){return e?a:(j(a,b,c,d,e,f),k(a,b,c,d,e,f),a)}}(window.GravityFlowFeedSettings=window.GravityFlowFeedSettings||{},jQuery);